<%- include('layout/header') %>
<%- include('layout/nav') %>
<!-- CSS Files -->
<link id="pagestyle" href="./assets/css/argon-dashboard.css?v=2.0.4" rel="stylesheet" />

<body>
  <section class="position-relative overflow-hidden pt-5 pt-lg-3">
    <div class="container">
      <div class="row">

        <div class="col-lg-12">
          <div class="card shadow-xs border">
            <div class="card-header pb-0">
              <div class="d-sm-flex align-items-center mb-3">
                <div>
                  <!--Job Ended Not Ok Bulanan-->
                  <div class="dropdown btn-group">
                    <button class="btn bg-gradient-info dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                      Date
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdownNotOkMonthlyDate">
                      <li><a class="dropdown-item" href="#">1</a></li>
                      <li><a class="dropdown-item" href="#">2</a></li>
                      <li><a class="dropdown-item" href="#">3</a></li>
                      <li><a class="dropdown-item" href="#">4</a></li>
                      <li><a class="dropdown-item" href="#">5</a></li>
                      <li><a class="dropdown-item" href="#">6</a></li>
                      <li><a class="dropdown-item" href="#">7</a></li>
                      <li><a class="dropdown-item" href="#">8</a></li>
                      <li><a class="dropdown-item" href="#">9</a></li>
                      <li><a class="dropdown-item" href="#">10</a></li>
                      <li><a class="dropdown-item" href="#">11</a></li>
                      <li><a class="dropdown-item" href="#">12</a></li>
                      <li><a class="dropdown-item" href="#">13</a></li>
                      <li><a class="dropdown-item" href="#">14</a></li>
                      <li><a class="dropdown-item" href="#">15</a></li>
                      <li><a class="dropdown-item" href="#">16</a></li>
                      <li><a class="dropdown-item" href="#">17</a></li>
                      <li><a class="dropdown-item" href="#">18</a></li>
                      <li><a class="dropdown-item" href="#">19</a></li>
                      <li><a class="dropdown-item" href="#">20</a></li>
                      <li><a class="dropdown-item" href="#">21</a></li>
                      <li><a class="dropdown-item" href="#">22</a></li>
                      <li><a class="dropdown-item" href="#">23</a></li>
                      <li><a class="dropdown-item" href="#">24</a></li>
                      <li><a class="dropdown-item" href="#">25</a></li>
                      <li><a class="dropdown-item" href="#">26</a></li>
                      <li><a class="dropdown-item" href="#">27</a></li>
                      <li><a class="dropdown-item" href="#">28</a></li>
                      <li><a class="dropdown-item" href="#">29</a></li>
                      <li><a class="dropdown-item" href="#">30</a></li>
                      <li><a class="dropdown-item" href="#">31</a></li>
                    </ul>
                  </div>
                  <div class="dropdown btn-group">
                    <button class="btn bg-gradient-info dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                      Month
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdownNotOkMonthlyMonth">
                      <li>
                        <a class="dropdown-item" href="#">January</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">February</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">March</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">April</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">May</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">June</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">July</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">August</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">September</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">October</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">November</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#">December</a>
                      </li>
                    </ul>
                  </div>
                  <div class="dropdown btn-group">
                    <button class="btn bg-gradient-info dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                      Year
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdownNotOkMonthlyYear">
                      <%- optionsTahunDashboard %>
                    </ul>
                  </div>
                  <div class="dropdown btn-group">
                    <button class="btn bg-gradient-info dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                      Environment
                    </button>
                    <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdownNotOkMonthlyEnvironment">
                      <li>
                        <a class="dropdown-item" href="#" title="MAINFRAME">Mainframe</a>
                      </li>
                      <li>
                        <a class="dropdown-item" href="#" title="OPEN SYSTEM">Open System</a>
                      </li>
                    </ul>
                  </div>
                  <h6 class="font-weight-semibold text-lg mb-0" id="headerNotOkMonthly">
                    Jobs Ended Not Ok <%- tanggal %> <%- bulan %> <%- tahun %> <%- environment %>
                  </h6>
                </div>
                <div class="ms-auto d-flex"></div>
              </div>
            </div>
            <div class="card-body p-3">
              <div class="chart mt-n6">
                <canvas id="chart-line-bulanan-notok" class="chart-canvas" height="225" width="696" style="
                  display: block;
                  box-sizing: border-box;
                  height: 300px;
                  width: 928px;"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!--Table Job Not OK-->
        <section class="pt-5">
          <div class="container">
            <div class="row g-4 g-sm-5">
              <!-- Main content START -->
              <div class="col-xl-12 mb-4 mb-sm-4">
                <!-- Personal info START -->
                <div class="card card-body shadow p-4">
                </div>
              </div>
            </div>
          </div>
        </section>




        <!-- Top 10 Job Ended Not Ok Open System -->
        <div class="row my-4">
          <div class="card shadow-xs border h-100">
            <div class="card-header pb-0">
              <div class="d-sm-flex align-items-center mb-3">
                <h6 class="font-weight-semibold text-lg mb-0">Top 10 Job Ended Not OK Open System</h6>
              </div>
              <div class="card-body py-3">
                <div class="chart mb-2">
                  <canvas id="chart-bars-top-10-not-ok-os" class="chart-canvas" height="240"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Top 10 Job Ended Not Ok Mainframe -->
        <div class="row my-4">
          <div class="card shadow-xs border">
            <div class="card-header pb-0">
              <div class="d-sm-flex align-items-center mb-3">
                <h6 class="font-weight-semibold text-lg mb-0">Top 10 Job Ended Not OK Mainframe</h6>
              </div>
              <div class="card-body py-3">
                <div class="chart mb-2">
                  <canvas id="chart-bars-top-10-not-ok-mf" class="chart-canvas" height="240"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
  </section>

</body>

<!-- Font Awesome Icons -->
<script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
<script src="./assets/js/plugins/chartjs.min.js"></script>

<!-- Control Center for Soft Dashboard: parallax effects, scripts for the example pages etc -->
<script src="./assets/js/argon-dashboard.min.js?v=2.0.4"></script>

<script type="application/javascript">
  var job_name_top_10_os = <%- job_name_top_10_os %>;
  var total_top_10_os = <%- total_top_10_os %>;
  var job_name_top_10_mf = <%- job_name_top_10_mf %>;
  var total_top_10_mf = <%- total_top_10_mf %>;
</script>

<script>
  let tanggal = "<%- tanggal %>"
  let bulan = "<%- bulan %>";
  let tahun = "<%- tahun %>";
  let environment = "<%- environment %>"

  function getEventTarget(e) {
    e = e || window.event;
    return e.target || e.srcElement;
  }

  //notOk

  var ul = document.getElementById("dropdownNotOkMonthlyDate");
  ul.onclick = function(event) {
    var target = getEventTarget(event);
    tanggal = target.innerHTML;
    document.getElementById("headerNotOkMonthly").innerHTML =
      "Job Ended Not Ok" + " " + tanggal + " " + bulan + " " + tahun + " " + environment;
    if (environment === "BCAPROD") {
      chartNotOkBulanan.destroy();
      createChartNotOkBulananMF();
    } else {
      chartNotOkBulanan.destroy();
      createChartNotOkBulananOS();
    }
  };

  var ul = document.getElementById("dropdownNotOkMonthlyMonth");
  ul.onclick = function(event) {
    var target = getEventTarget(event);
    bulan = target.innerHTML;
    document.getElementById("headerNotOkMonthly").innerHTML =
      "Job Ended Not Ok" + " " + tanggal + " " + bulan + " " + tahun + " " + environment;
    if (environment === "BCAPROD") {
      chartNotOkBulanan.destroy();
      createChartNotOkBulananMF();
    } else {
      chartNotOkBulanan.destroy();
      createChartNotOkBulananOS();
    }
  };

  //not ok tahun
  var ul = document.getElementById("dropdownNotOkMonthlyYear");
  ul.onclick = function(event) {
    var target = getEventTarget(event);
    tahun = target.innerHTML;
    document.getElementById("headerNotOkMonthly").innerHTML =
      "Job Ended Not Ok" + " " + tanggal + " " + bulan + " " + tahun + " " + environment;
    if (environment === "BCAPROD") {
      chartNotOkBulanan.destroy();
      createChartNotOkBulananMF();
    } else {
      chartNotOkBulanan.destroy();
      createChartNotOkBulananOS();
    }
  };

  //not ok environment
  var ulenv = document.getElementById("dropdownNotOkMonthlyEnvironment");
  ulenv.onclick = function(event) {
    var target = getEventTarget(event);
    environment = target.title;
    document.getElementById("headerNotOkMonthly").innerHTML =
      "Job Ended Not Ok" + " " + tanggal + " " + bulan + " " + tahun + " " + environment;

    if (environment === "BCAPROD") {
      chartNotOkBulanan.destroy();
      createChartNotOkBulananMF();
    } else {
      chartNotOkBulanan.destroy();
      createChartNotOkBulananOS();
    }

    // console.log(environment)
  };

  //not ok
  async function getDataNotOkBulanan(url) {
    const response = await fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        tanggal,
        bulan,
        tahun,
        environment
      }),
    });

    let data = await response.json();
    console.log(await response.status);
    return data;
  }

  async function getDataNotOkBulananDetail(url) {
    const response = await fetch(url, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        tanngal,
        bulan,
        tahun,
        environment
      }),
    });

    let data = await response.json();
    console.log(await response.status);
    return data;
  }
</script>

<script src="./javascript/chartTop10NotOK.js"></script>
<script src="./javascript/chartNotOkBulanan.js"></script>
<script src="./javascript/chartNotOkBulananDetail.js"></script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>